# 郵件功能設置指南

## 功能說明

BonBunny 烘焙坊現在支援以下郵件功能：

### 1. 📧 訂單確認信
- **觸發時機**：客戶下單後自動發送
- **收件人**：客戶填寫的 Email
- **內容包含**：
  - 訂單詳細資訊
  - 收件人資料
  - 付款方式說明
  - 銀行匯款資訊
  - 後續步驟指引

### 2. 💰 匯款通知信
- **觸發時機**：客戶回報匯款資訊後自動發送
- **收件人**：客戶填寫的 Email
- **內容包含**：
  - 匯款資訊確認
  - 訂單處理狀態
  - 後續流程說明

### 3. 🔔 管理員通知信
- **新訂單通知**：有新訂單時發送到管理員信箱
- **匯款通知**：客戶回報匯款時發送到管理員信箱
- **收件人**：yuchen880401@gmail.com

## 環境設置

### 1. Gmail 設定步驟

#### Step 1: 啟用兩步驟驗證
1. 登入 Gmail 帳戶
2. 前往 [Google 帳戶設定](https://myaccount.google.com/)
3. 點選「安全性」
4. 啟用「兩步驟驗證」

#### Step 2: 產生應用程式密碼
1. 在安全性頁面找到「應用程式密碼」
2. 選取「郵件」和「Windows 電腦」
3. 點擊「產生」
4. 複製產生的 16 位密碼

### 2. 環境變數設定

在專案根目錄建立 `.env.local` 檔案：

```bash
# 郵件設定
EMAIL_USER=your-email@gmail.com
EMAIL_PASSWORD=your-16-digit-app-password
```

⚠️ **注意事項**：
- 使用應用程式密碼，不是 Gmail 登入密碼
- 不要將 `.env.local` 提交到版本控制
- 確保 `.env.local` 已加入 `.gitignore`

### 3. 測試郵件功能

1. 登入管理後台
2. 前往「郵件測試」頁面
3. 輸入有效的訂單編號
4. 點擊測試按鈕

## 使用流程

### 客戶下單流程
```
客戶下單 → 系統創建訂單 → 發送確認信給客戶 → 發送新訂單通知給管理員
```

### 匯款通知流程
```
客戶匯款 → 客戶回報匯款資訊 → 發送匯款確認信給客戶 → 發送匯款通知給管理員
```

## 郵件模板特色

### 🎨 精美設計
- 響應式設計，支援各種裝置
- 漸層背景和現代化排版
- 清晰的資訊層次

### 📊 詳細資訊
- 完整訂單明細表格
- 清楚的付款指示
- 聯絡資訊和後續步驟

### 🔒 安全可靠
- 自動生成唯一訂單編號
- 完整的錯誤處理機制
- 即使郵件發送失敗也不影響訂單創建

## 故障排除

### 常見問題

#### Q: 郵件發送失敗怎麼辦？
A: 檢查以下項目：
1. 環境變數是否正確設定
2. 是否使用應用程式密碼而非一般密碼
3. Gmail 兩步驟驗證是否已啟用
4. 網路連線是否正常

#### Q: 收不到郵件？
A: 檢查以下項目：
1. 垃圾郵件資料夾
2. Email 地址是否正確
3. 郵件伺服器日誌
4. 使用管理後台的郵件測試功能

#### Q: 郵件格式異常？
A: 確認：
1. 訂單資料是否完整
2. 匯款資訊是否已正確回報
3. 瀏覽器是否支援 HTML 郵件

### 系統日誌

郵件發送狀態會記錄在伺服器日誌中：
- ✅ 成功：`Order confirmation email sent: messageId`
- ❌ 失敗：`Failed to send order confirmation email: error`

## 維護建議

1. **定期測試**：每週使用測試功能確認郵件系統正常
2. **監控日誌**：注意郵件發送失敗的錯誤訊息
3. **備用方案**：考慮設定備用 SMTP 服務
4. **效能監控**：追蹤郵件發送時間和成功率

---

🎂 **BonBunny 烘焙坊** - 美味與科技的完美結合！
